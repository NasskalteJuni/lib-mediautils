<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>initializing...</title>
</head>
<body>
    <script>
        window.connections = new ConnectionManager();
        window.videoMixer = new VideoMixer({fps});
        window.speechDetection = new SpeechDetection();
        speechDetection.onSpeakerChange(speakers => console.log(speakers.join[', '],' are currently speaking'));
        document.body.appendChild(videoMixer._canvas);
        window.audioMixer = new AudioMixer();
        window.recorder = new Recorder(new MediaStream([videoMixer.outputTrack, audioMixer.outputTrack]));
        connections.onNewPeerConnection(function(userId, peerConnection){
            peerConnection.addTransceiver(...new Transcriber(videoMixer.outputTrack, {direction: 'sendonly', streams: [videoMixer.out]}).transcribe('medium'));
            peerConnection.addTransceiver(...new Transcriber(audioMixer.outputTrack, {direction: 'sendonly', streams: [audioMixer.out]}).transcribe('medium'));
        });
        connections.onTrackHandle(function(userId, track, streams){
            if(track.kind === "video"){
                const stream = streams && streams.length ? streams[0] : new MediaStream([track]);
                videoMixer.addStream(stream, userId);
            }
            if(track.kind === "audio"){
                const stream = streams && streams.length ? streams[0] : new MediaStream([track]);
                audioMixer.addStream(stream, userId);
                speechDetection.addStream(stream, userId);
            }
        });
        connections.onDisconnect(function(userId){
            videoMixer.removeStream(userId);
        });
    </script>
</body>
</html>